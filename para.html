<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ò–≥—Ä–∞ "–ù–∞–π–¥–∏ –ü–∞—Ä—É"</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, rgb(202, 153, 255) 0%, #6ca2ff 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: white;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 800px;
            text-align: center;
        }

        .header-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        h1 {
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin: 0;
        }

        .header-sound-controls {
            display: flex;
            gap: 10px;
        }

        .sound-button {
            padding: 10px 20px;
            font-size: 1em;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .sound-button:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .sound-button.active {
            background: rgba(46, 204, 113, 0.3);
            border-color: #2ecc71;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .stat {
            flex: 1;
            margin: 0 10px;
        }

        .stat h3 {
            font-size: 1em;
            margin-bottom: 5px;
            opacity: 0.9;
        }

        .stat p {
            font-size: 1.5em;
            font-weight: bold;
        }

        .game-info {
            margin-bottom: 20px;
        }

        #difficulty {
            padding: 10px 20px;
            font-size: 1em;
            border-radius: 5px;
            border: none;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.9);
            cursor: pointer;
        }

        #startButton {
            padding: 15px 40px;
            font-size: 1.2em;
            background: linear-gradient(45deg, #FF416C, #FF4B2B);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 5px 15px rgba(255, 75, 43, 0.4);
            margin-bottom: 20px;
        }

        #startButton:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(255, 75, 43, 0.6);
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .control-button {
            flex: 1;
            min-width: 120px;
            padding: 12px 15px;
            font-size: 1em;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
            text-align: center;
        }

        .control-button:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .game-board {
            display: grid;
            gap: 10px;
            margin: 0 auto;
            width: 100%;
            max-width: 500px;
        }

        .card {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            cursor: pointer;
            transition: all 0.3s;
            transform-style: preserve-3d;
            position: relative;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .card.flipped {
            background: white;
            color: #333;
            transform: rotateY(180deg);
        }

        .card.matched {
            background: linear-gradient(45deg, #00b09b, #96c93d);
            border-color: #00b09b;
            cursor: default;
        }

        /* –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –¥–æ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã */
        @media (max-width: 768px) {
            .controls {
                display: none;
            }
            
            .controls.game-started {
                display: flex;
            }
            
            .card {
                font-size: 2em;
            }
            
            .stat p {
                font-size: 1.2em;
            }
            
            .control-button {
                padding: 10px 10px;
                font-size: 0.9em;
                min-width: 100px;
            }
            
            .game-board {
                max-width: 90vw;
                gap: 8px;
            }
            
            .header-container {
                flex-direction: column;
                text-align: center;
            }
            
            .header-sound-controls {
                justify-content: center;
            }
            
            .sound-button {
                padding: 8px 15px;
                font-size: 0.9em;
            }
        }

        @media (max-width: 480px) {
            .card {
                font-size: 1.8em;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .control-button {
                padding: 8px 8px;
                font-size: 0.8em;
                min-width: 90px;
            }
            
            .game-board {
                max-width: 95vw;
                gap: 6px;
            }
            
            .stats {
                padding: 10px;
            }
            
            .stat {
                margin: 0 5px;
            }
            
            .stat p {
                font-size: 1.2em;
            }
            
            .sound-button {
                padding: 8px 15px;
                font-size: 0.9em;
            }
        }

        @media (max-width: 360px) {
            .card {
                font-size: 1.5em;
            }
            
            .game-board {
                gap: 5px;
            }
            
            .control-button {
                min-width: 80px;
                padding: 6px 6px;
                font-size: 0.7em;
            }
            
            #difficulty {
                padding: 8px 15px;
                font-size: 0.9em;
            }
            
            #startButton {
                padding: 12px 30px;
                font-size: 1em;
            }
            
            .sound-button {
                padding: 6px 12px;
                font-size: 0.8em;
            }
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ */
        .game-board.easy {
            max-width: 400px;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(4, 1fr);
        }
        
        .game-board.medium {
            max-width: 550px;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(4, 1fr);
        }
        
        .game-board.hard {
            max-width: 550px;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(6, 1fr);
        }

        @media (max-width: 600px) {
            .game-board.easy {
                max-width: 90vw;
                grid-template-columns: repeat(4, 1fr);
                grid-template-rows: repeat(4, 1fr);
            }
            
            .game-board.medium {
                max-width: 95vw;
                grid-template-columns: repeat(6, 1fr);
                grid-template-rows: repeat(4, 1fr);
            }
            
            .game-board.hard {
                max-width: 95vw;
                grid-template-columns: repeat(6, 1fr);
                grid-template-rows: repeat(6, 1fr);
            }
        }

        @media (max-width: 400px) {
            .game-board.easy {
                max-width: 95vw;
            }
            
            .game-board.medium {
                max-width: 100vw;
                padding: 0 10px;
            }
            
            .game-board.hard {
                max-width: 100vw;
                padding: 0 10px;
            }
        }

        .win-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(72, 255, 160, 0.7);
            padding: 50px 30px;
            border-radius: 20px;
            text-align: center;
            display: none;
            z-index: 1000;
            border: 3px solid #FFD700;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
            max-width: 90vw;
            width: auto;
        }

        .win-message.show {
            display: block;
            animation: popIn 0.5s ease-out;
        }

        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .win-message h2 {
            color: #FFD700;
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .win-message p {
            font-size: 1.4em;
            margin-bottom: 10px;
        }

        #newRecord {
            color: #FFD700;
            font-weight: bold;
            font-size: 1.8em;
            margin: 20px 0;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        #closeWinMessage {
            padding: 15px 30px;
            font-size: 1.2em;
            background: linear-gradient(45deg, #FF416C, #FF4B2B);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.3s;
            margin-top: 10px;
        }

        #closeWinMessage:hover {
            transform: scale(1.05);
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            z-index: 999;
        }

        .overlay.show {
            display: block;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ */
        :fullscreen .fullscreen-hide {
            display: none;
        }
        
        :-webkit-full-screen .fullscreen-hide {
            display: none;
        }
        
        :-moz-full-screen .fullscreen-hide {
            display: none;
        }
    </style>
</head>
<body>
    <!-- –ê—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏ -->
    <audio id="backgroundMusic" loop>
        <source src="put_k_schastyu.mp3" type="audio/mpeg">
        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç.
    </audio>
    
    <div class="container">
        <div class="header-container">
            <h1>üåô –ù–∞–π–¥–∏ –ü–∞—Ä—É ‚òÄÔ∏è</h1>
            <div class="header-sound-controls">
                <button class="sound-button" id="musicButton">
                    <span id="musicIcon">üéµ</span>
                    <span id="musicText">–ú—É–∑—ã–∫–∞ –≤–∫–ª</span>
                </button>
                <button class="sound-button" id="soundButton">
                    <span id="soundIcon">üîä</span>
                    <span id="soundText">–ó–≤—É–∫–∏ –≤–∫–ª</span>
                </button>
            </div>
        </div>
        
        <div class="stats">
            <div class="stat">
                <h3>–•–û–î–´</h3>
                <p id="moves">0</p>
            </div>
            <div class="stat">
                <h3>–¢–ê–ô–ú–ï–†</h3>
                <p id="timer">00:00</p>
            </div>
            <div class="stat">
                <h3>–†–ï–ö–û–†–î</h3>
                <p id="record">-</p>
            </div>
        </div>

        <div class="game-info">
            <select id="difficulty">
                <option value="easy">–õ–µ–≥–∫–∏–π (4x4)</option>
                <option value="medium" selected>–°—Ä–µ–¥–Ω–∏–π (6x4)</option>
                <option value="hard">–°–ª–æ–∂–Ω—ã–π (6x6)</option>
            </select>
        </div>

        <button id="startButton">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>

        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è - –±—É–¥—É—Ç —Å–∫—Ä—ã—Ç—ã –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö –¥–æ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã -->
        <div class="controls" id="gameControls">
            <button class="control-button" id="pauseButton">‚è∏ –ü–∞—É–∑–∞</button>
            <button class="control-button" id="resetButton">üîÑ –°–±—Ä–æ—Å</button>
            <button class="control-button" id="fullscreenButton">‚õ∂ –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω</button>
        </div>

        <div class="game-board" id="gameBoard"></div>
    </div>

    <div class="overlay" id="overlay"></div>
    
    <div class="win-message" id="winMessage">
        <h2>üéâ –ü–æ–±–µ–¥–∞!</h2>
        <p>–í—Ä–µ–º—è: <span id="finalTime">00:00</span></p>
        <p>–•–æ–¥—ã: <span id="finalMoves">0</span></p>
        <div id="newRecord" style="display: none;">–ù–û–í–´–ô –†–ï–ö–û–†–î! üèÜ</div>
        <button id="closeWinMessage">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    </div>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const gameBoard = document.getElementById('gameBoard');
        const startButton = document.getElementById('startButton');
        const pauseButton = document.getElementById('pauseButton');
        const resetButton = document.getElementById('resetButton');
        const fullscreenButton = document.getElementById('fullscreenButton');
        const gameControls = document.getElementById('gameControls');
        const movesElement = document.getElementById('moves');
        const timerElement = document.getElementById('timer');
        const recordElement = document.getElementById('record');
        const difficultySelect = document.getElementById('difficulty');
        const winMessage = document.getElementById('winMessage');
        const overlay = document.getElementById('overlay');
        const finalTimeElement = document.getElementById('finalTime');
        const finalMovesElement = document.getElementById('finalMoves');
        const newRecordElement = document.getElementById('newRecord');
        const closeWinMessageButton = document.getElementById('closeWinMessage');
        const backgroundMusic = document.getElementById('backgroundMusic');

        // –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤—É–∫–æ–º –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
        const musicButton = document.getElementById('musicButton');
        const soundButton = document.getElementById('soundButton');
        const musicIcon = document.getElementById('musicIcon');
        const musicText = document.getElementById('musicText');
        const soundIcon = document.getElementById('soundIcon');
        const soundText = document.getElementById('soundText');

        // –ú–∞—Å—Å–∏–≤ —ç–º–æ–¥–∑–∏ –¥–ª—è –∏–≥—Ä—ã
        const emojis = [
            'üéÑ', 'üéÖ', 'üë®', 'üë©', '‚ùÑÔ∏è', '‚òÄÔ∏è', 'üçÄ', 'üå≥',
            'ü¶å', 'üè†', 'üåÖ', 'üå∏', 'üöó', 'üêé', 'üêï', 'üêà',
            'üê¶', 'üê†', 'üåô', '‚≠ê', '‚öΩ', 'üèÄ', 'üé∏', 'üé®',
            'üçé', 'üéÅ', 'üé™', 'üöÄ', 'üèñÔ∏è', 'üåç', 'üåà', 'üéØ',
            'ü¶Ñ', 'ü¶ï', 'ü¶ñ', 'üêã', 'ü¶Ö', 'ü¶â', 'ü¶ö', 'ü¶ú'
        ];

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã
        let cards = [];
        let flippedCards = [];
        let moves = 0;
        let matches = 0;
        let gameStarted = false;
        let gamePaused = false;
        let timer = 0;
        let timerInterval = null;
        let totalPairs = 0;
        let canFlip = true;
        let isMobile = window.innerWidth <= 768;

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–≤—É–∫–∞
        let musicEnabled = true;
        let soundEnabled = true;

        // –ê—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –∑–≤—É–∫–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
        let audioContext = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
        function initAudioContext() {
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    return false;
                }
            }
            
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            
            return true;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –∑–≤—É–∫–∞
        function createTone(frequency, duration, type = 'sine', volume = 0.3) {
            if (!soundEnabled || !audioContext) return null;
            
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.type = type;
                oscillator.frequency.value = frequency;
                
                gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + duration);
                
                return oscillator;
            } catch (e) {
                return null;
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–≤—É–∫–∞ –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç–∞ –∫–∞—Ä—Ç–æ—á–∫–∏
        function playFlipSound() {
            if (!soundEnabled) return;
            initAudioContext();
            createTone(800, 0.15, 'sine', 0.2);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–≤—É–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
        function playMatchSound() {
            if (!soundEnabled) return;
            initAudioContext();
            createTone(523.25, 0.1, 'sine', 0.3);
            setTimeout(() => {
                createTone(659.25, 0.1, 'sine', 0.3);
                setTimeout(() => {
                    createTone(783.99, 0.2, 'sine', 0.3);
                }, 100);
            }, 50);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–≤—É–∫–∞ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
        function playMismatchSound() {
            if (!soundEnabled) return;
            initAudioContext();
            createTone(400, 0.3, 'sawtooth', 0.2);
            setTimeout(() => {
                createTone(300, 0.2, 'sawtooth', 0.15);
            }, 100);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∑–≤—É–∫–∞ –ø–æ–±–µ–¥—ã
        function playWinSound() {
            if (!soundEnabled) return;
            initAudioContext();
            const notes = [
                { freq: 523.25, duration: 0.15 },
                { freq: 659.25, duration: 0.15 },
                { freq: 783.99, duration: 0.15 },
                { freq: 1046.50, duration: 0.3 },
                { freq: 783.99, duration: 0.15 },
                { freq: 1046.50, duration: 0.5 }
            ];
            
            notes.forEach((note, index) => {
                setTimeout(() => {
                    createTone(note.freq, note.duration, 'sine', 0.3);
                }, index * 150);
            });
        }

        // –ó–∞–ø—É—Å–∫ —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏
        function startBackgroundMusic() {
            if (!musicEnabled) return;
            
            try {
                backgroundMusic.currentTime = 0;
                backgroundMusic.volume = 0.3;
                backgroundMusic.play().catch(e => {});
            } catch (e) {}
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏
        function stopBackgroundMusic() {
            try {
                backgroundMusic.pause();
                backgroundMusic.currentTime = 0;
            } catch (e) {}
        }

        // –ü–∞—É–∑–∞ —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏
        function pauseBackgroundMusic() {
            if (musicEnabled && !backgroundMusic.paused) {
                backgroundMusic.pause();
            }
        }

        // –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ñ–æ–Ω–æ–≤–æ–π –º—É–∑—ã–∫–∏
        function resumeBackgroundMusic() {
            if (musicEnabled && backgroundMusic.paused) {
                backgroundMusic.play().catch(e => {});
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∑–≤—É–∫–∞ –∏–∑ localStorage
        function loadSoundSettings() {
            const savedMusic = localStorage.getItem('memoryGameMusic');
            const savedSound = localStorage.getItem('memoryGameSound');
            
            if (savedMusic !== null) {
                musicEnabled = savedMusic === 'true';
            }
            
            if (savedSound !== null) {
                soundEnabled = savedSound === 'true';
            }
            
            updateSoundButtons();
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∑–≤—É–∫–∞ –≤ localStorage
        function saveSoundSettings() {
            localStorage.setItem('memoryGameMusic', musicEnabled);
            localStorage.setItem('memoryGameSound', soundEnabled);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –∑–≤—É–∫–∞
        function updateSoundButtons() {
            if (musicEnabled) {
                musicIcon.textContent = 'üéµ';
                musicText.textContent = '–ú—É–∑—ã–∫–∞ –≤–∫–ª';
                musicButton.classList.add('active');
                if (gameStarted && !gamePaused) {
                    resumeBackgroundMusic();
                }
            } else {
                musicIcon.textContent = 'üîá';
                musicText.textContent = '–ú—É–∑—ã–∫–∞ –≤—ã–∫–ª';
                musicButton.classList.remove('active');
                stopBackgroundMusic();
            }
            
            if (soundEnabled) {
                soundIcon.textContent = 'üîä';
                soundText.textContent = '–ó–≤—É–∫–∏ –≤–∫–ª';
                soundButton.classList.add('active');
            } else {
                soundIcon.textContent = 'üîá';
                soundText.textContent = '–ó–≤—É–∫–∏ –≤—ã–∫–ª';
                soundButton.classList.remove('active');
            }
            
            saveSoundSettings();
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (–≤—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
        function getRecord() {
            const difficulty = difficultySelect.value;
            return localStorage.getItem(`memoryGameRecord_${difficulty}`) || null;
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∫–æ—Ä–¥–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ (–≤—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö)
        function saveRecord(timeInSeconds) {
            const difficulty = difficultySelect.value;
            localStorage.setItem(`memoryGameRecord_${difficulty}`, timeInSeconds);
        }

        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏–∑ —Å–µ–∫—É–Ω–¥ –≤ MM:SS
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60).toString().padStart(2, '0');
            const secs = (seconds % 60).toString().padStart(2, '0');
            return `${minutes}:${secs}`;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∫–æ—Ä–¥–∞
        function updateRecordDisplay() {
            const record = getRecord();
            if (record) {
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ä–µ–∫–æ—Ä–¥ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –≤—Ä–µ–º–µ–Ω–∏
                recordElement.textContent = formatTime(parseInt(record));
            } else {
                recordElement.textContent = '-';
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            const difficulty = difficultySelect.value;
            let rows, cols;
            
            switch(difficulty) {
                case 'easy':
                    rows = cols = 4;
                    break;
                case 'medium':
                    rows = 4;
                    cols = 6;
                    break;
                case 'hard':
                    rows = cols = 6;
                    break;
            }
            
            totalPairs = (rows * cols) / 2;
            matches = 0;
            moves = 0;
            flippedCards = [];
            canFlip = true;
            
            const gameEmojis = emojis.slice(0, totalPairs);
            
            let emojiPairs = [];
            for (let i = 0; i < totalPairs; i++) {
                emojiPairs.push(gameEmojis[i], gameEmojis[i]);
            }
            
            emojiPairs = emojiPairs.sort(() => Math.random() - 0.5);
            
            gameBoard.innerHTML = '';
            gameBoard.className = 'game-board';
            gameBoard.classList.add(difficulty);
            
            cards = emojiPairs.map((emoji, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.emoji = emoji;
                card.dataset.index = index;
                
                card.addEventListener('click', () => flipCard(card));
                
                gameBoard.appendChild(card);
                return {
                    element: card,
                    emoji: emoji,
                    flipped: false,
                    matched: false
                };
            });
            
            movesElement.textContent = '0';
            timerElement.textContent = '00:00';
            timer = 0;
            
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            if (isMobile) {
                gameControls.classList.remove('game-started');
            }
            
            gameStarted = false;
            gamePaused = false;
            pauseButton.textContent = '‚è∏ –ü–∞—É–∑–∞';
            
            winMessage.classList.remove('show');
            overlay.classList.remove('show');
            
            updateRecordDisplay();
            stopBackgroundMusic();
        }

        // –ü–µ—Ä–µ–≤–æ—Ä–æ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏
        function flipCard(cardElement) {
            if (!gameStarted || gamePaused || !canFlip) return;
            
            const card = cards.find(c => c.element === cardElement);
            if (!card || card.flipped || card.matched) return;
            
            playFlipSound();
            
            card.flipped = true;
            card.element.classList.add('flipped');
            card.element.textContent = card.emoji;
            flippedCards.push(card);
            
            if (flippedCards.length === 2) {
                moves++;
                movesElement.textContent = moves;
                
                canFlip = false;
                
                const [card1, card2] = flippedCards;
                
                if (card1.emoji === card2.emoji) {
                    card1.matched = true;
                    card2.matched = true;
                    card1.element.classList.add('matched');
                    card2.element.classList.add('matched');
                    matches++;
                    
                    playMatchSound();
                    
                    flippedCards = [];
                    canFlip = true;
                    
                    if (matches === totalPairs) {
                        endGame();
                    }
                } else {
                    setTimeout(() => {
                        card1.flipped = false;
                        card2.flipped = false;
                        card1.element.classList.remove('flipped');
                        card2.element.classList.remove('flipped');
                        card1.element.textContent = '';
                        card2.element.textContent = '';
                        flippedCards = [];
                        canFlip = true;
                        
                        playMismatchSound();
                    }, 1000);
                }
            }
        }

        // –°—Ç–∞—Ä—Ç –∏–≥—Ä—ã
        function startGame() {
            if (gameStarted) return;
            
            gameStarted = true;
            gamePaused = false;
            startButton.textContent = '–ò–≥—Ä–∞ –Ω–∞—á–∞—Ç–∞!';
            startButton.disabled = true;
            pauseButton.textContent = '‚è∏ –ü–∞—É–∑–∞';
            
            initAudioContext();
            
            if (isMobile) {
                gameControls.classList.add('game-started');
            }
            
            timerInterval = setInterval(() => {
                if (!gamePaused) {
                    timer++;
                    const minutes = Math.floor(timer / 60).toString().padStart(2, '0');
                    const seconds = (timer % 60).toString().padStart(2, '0');
                    timerElement.textContent = `${minutes}:${seconds}`;
                }
            }, 1000);
            
            if (musicEnabled) {
                startBackgroundMusic();
            }
        }

        // –ü–∞—É–∑–∞/–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –∏–≥—Ä—ã
        function togglePause() {
            if (!gameStarted) return;
            
            gamePaused = !gamePaused;
            pauseButton.textContent = gamePaused ? '‚ñ∂ –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å' : '‚è∏ –ü–∞—É–∑–∞';
            
            if (gamePaused) {
                clearInterval(timerInterval);
                cards.forEach(card => {
                    card.element.style.pointerEvents = 'none';
                });
                
                pauseBackgroundMusic();
            } else {
                timerInterval = setInterval(() => {
                    timer++;
                    const minutes = Math.floor(timer / 60).toString().padStart(2, '0');
                    const seconds = (timer % 60).toString().padStart(2, '0');
                    timerElement.textContent = `${minutes}:${seconds}`;
                }, 1000);
                
                cards.forEach(card => {
                    if (!card.matched) {
                        card.element.style.pointerEvents = 'auto';
                    }
                });
                
                if (musicEnabled) {
                    resumeBackgroundMusic();
                }
            }
        }

        // –°–±—Ä–æ—Å –∏–≥—Ä—ã
        function resetGame() {
            clearInterval(timerInterval);
            initGame();
            startButton.textContent = '–ù–∞—á–∞—Ç—å –∏–≥—Ä—É';
            startButton.disabled = false;
            
            if (isMobile) {
                gameControls.classList.remove('game-started');
            }
        }

        // –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                } else if (document.documentElement.webkitRequestFullscreen) {
                    document.documentElement.webkitRequestFullscreen();
                } else if (document.documentElement.msRequestFullscreen) {
                    document.documentElement.msRequestFullscreen();
                }
                fullscreenButton.textContent = '‚úï –í—ã—Ö–æ–¥';
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                fullscreenButton.textContent = '‚õ∂ –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω';
            }
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã
        function endGame() {
            clearInterval(timerInterval);
            
            const minutes = Math.floor(timer / 60).toString().padStart(2, '0');
            const seconds = (timer % 60).toString().padStart(2, '0');
            const currentTime = `${minutes}:${seconds}`;
            finalTimeElement.textContent = currentTime;
            finalMovesElement.textContent = moves;
            
            const currentRecord = getRecord();
            let currentRecordValue = currentRecord ? parseInt(currentRecord) : null;
            
            let newRecord = false;
            if (currentRecordValue === null || timer < currentRecordValue) {
                saveRecord(timer);
                newRecord = true;
                newRecordElement.style.display = 'block';
            } else {
                newRecordElement.style.display = 'none';
            }
            
            updateRecordDisplay();
            
            playWinSound();
            stopBackgroundMusic();
            
            setTimeout(() => {
                winMessage.classList.add('show');
                overlay.classList.add('show');
            }, 500);
        }

        // –°–æ–±—ã—Ç–∏—è
        startButton.addEventListener('click', () => {
            if (!gameStarted) {
                startGame();
            }
        });

        pauseButton.addEventListener('click', togglePause);
        resetButton.addEventListener('click', resetGame);
        fullscreenButton.addEventListener('click', toggleFullscreen);

        musicButton.addEventListener('click', () => {
            musicEnabled = !musicEnabled;
            updateSoundButtons();
        });

        soundButton.addEventListener('click', () => {
            soundEnabled = !soundEnabled;
            updateSoundButtons();
        });

        closeWinMessageButton.addEventListener('click', () => {
            winMessage.classList.remove('show');
            overlay.classList.remove('show');
            resetGame();
        });

        difficultySelect.addEventListener('change', () => {
            if (!gameStarted) {
                initGame();
            }
        });

        window.addEventListener('resize', () => {
            isMobile = window.innerWidth <= 768;
            if (isMobile && !gameStarted) {
                gameControls.classList.remove('game-started');
            }
        });

        document.addEventListener('fullscreenchange', updateFullscreenButton);
        document.addEventListener('webkitfullscreenchange', updateFullscreenButton);
        document.addEventListener('msfullscreenchange', updateFullscreenButton);

        function updateFullscreenButton() {
            if (document.fullscreenElement || 
                document.webkitFullscreenElement || 
                document.msFullscreenElement) {
                fullscreenButton.textContent = '‚úï –í—ã—Ö–æ–¥';
            } else {
                fullscreenButton.textContent = '‚õ∂ –ü–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω';
            }
        }

        loadSoundSettings();
        initGame();
    </script>
</body>
</html>